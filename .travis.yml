services:
    - docker

before_install:
    - docker build -t igormcsouza/estacamontese:test . -f deploy/Dockerfile.dev

script:
    - docker run igormcsouza/estacamontese:test npm run test:unit

deploy:
    provider: heroku
    api_key:
        secure: "$HEROKU_KEY"
    app: estacamontese
    run:
        - "docker build -f deploy/Dockerfile -t igormcsouza/estacamontese:production . "
        - "heroku container:login"
        - "docker tag igormcsouza/estacamontese:production registry.heroku.com/estacamontese/web"
        - "docker push registry.heroku.com/estacamontese/web"
        - "heroku container:release web -a estacamontese"
    on: production